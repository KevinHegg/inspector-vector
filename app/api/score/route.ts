import { NextResponse } from "next/server";type Action={type:"stabilize"|"magnetize"|"beam"|"extend"|"normalize";payload?:any};type RunInput={seed:string;actions:Action[];layer:number};function fib(n:number){const f=[0,1,1,2,3,5,8,13,21,34,55,89];return f[n]??0;}export async function POST(req:Request){const body:RunInput=await req.json();const coherence=0.82,completeness=0.74,fluency=0.76;const quality=0.58,lambda=0.6;const cleared=coherence>=0.80&&completeness>=0.70;const base=cleared?fib(body.layer):0;const layerScore=cleared?base*(1+lambda*quality):0;return NextResponse.json({cleared,meters:{coherence,completeness,fluency},quality,layerScore});}
